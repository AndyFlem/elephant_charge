<div class="col-sm-6">
  <div class="heading-bar">
    <h3>Pledge</h3>
  </div>
  <table class="table table-sm">
    <thead class="thead-inverse">
    <tr>
      <th>Position</th>
      <th>Team No</th>
      <th>Team</th>
      <th>Kwacha</th>
      <th>Dollars</th>
    </tr>
    </thead>

    <% @raised.each_with_index do |entry,i| %>
        <tr>
          <td><%= i+1 %></td>
          <td><%= entry.car_no %> </td>
          <td><%= link_to entry.name,team_path(entry.team) %></td>
          <td>K<%= entry.raised_kwacha.nil? ? '  -' : number_with_precision(entry.raised_kwacha, precision: 0,delimiter: ',') %></td>
          <td>$<%= entry.raised_kwacha.nil? ? '  -' : number_with_precision(entry.raised_kwacha/@charge.exchange_rate, precision: 0,delimiter: ',') %></td>
        </tr>
    <% end %>
  </table>
</div>

<div class="col-sm-7">
  <div class="heading-bar">
    <h3>Net Distance</h3>
  </div>
  <table class="table table-sm">
    <thead class="thead-inverse">
    <tr>
      <th>Position</th>
      <th>Team No</th>
      <th>Team</th>
      <th>Kwacha</th>
      <th>Dollars</th>
      <th>Competition Distance</th>
      <th>Distance for Pledge</th>
      <th>Net Distance</th>
    </tr>
    </thead>

    <% @net.each do |entry| %>
        <tr>
          <td><%= entry.position_net_distance %></td>
          <td><%= entry.car_no %> </td>
          <td><%= link_to entry.name,team_path(entry.team) %></td>
          <td>K<%= entry.raised_kwacha.nil? ? '  -' : number_with_precision(entry.raised_kwacha, precision: 0, delimiter: ',') %></td>
          <td>$<%= entry.raised_kwacha.nil? ? '  -' : number_with_precision(entry.raised_dollars, precision: 0, delimiter: ',') %></td>
          <td><%= number_with_precision(entry.dist_competition/1000.0, precision: 2) %>km</td>
          <% if entry.dist_net.nil? %>
              <td>n/a</td>
              <td>n/a</td>
          <% else %>
              <td><%= number_with_precision(-entry.raised_kwacha*entry.charge.m_per_kwacha/1000, precision: 2) %>km</td>
              <td><%= number_with_precision(entry.dist_net/1000.0, precision: 2) %>km</td>
          <% end %>
        </tr>
    <% end %>
  </table>
</div>


<div class="col-sm-9">
  <div class="heading-bar">
    <h3>Shortest Distance</h3>
  </div>
  <table class="table table-sm">
    <thead class="thead-inverse">
    <tr>
      <th>Position</th>
      <th>Team No</th>
      <th>Team</th>
      <th>Result</th>
      <th>Best Distance</th>
      <th>Actual Distance</th>
      <th>Gauntlet Distance</th>
      <th>Gauntlet Penalties</th>
      <th>Competition Distance</th>
    </tr>
    </thead>

    <% @shortest_dist.each do |entry| %>
        <tr>
          <td><%= entry.position_distance %></td>
          <td><%= entry.car_no %> </td>
          <td><%= link_to entry.name,team_path(entry.team) %></td>
          <td>
            <%= entry.result %>
          </td>
          <td><%= entry.dist_best.nil? ? '' : number_with_precision(entry.dist_best/1000.0, precision: 2) %>km</td>
          <td><%= number_with_precision(entry.dist_real/1000.0, precision: 2) %>km</td>
          <td><%= number_with_precision(entry.dist_gauntlet/1000.0, precision: 2) %>km</td>
          <td><%= number_with_precision(entry.dist_penalty_gauntlet/1000.0, precision: 2) %>km</td>
          <td><%= number_with_precision(entry.dist_competition/1000.0, precision: 2) %>km</td>
        </tr>
    <% end %>
  </table>
</div>
<div class="col-sm-7">
  <div class="heading-bar">
    <h3>Gauntlet</h3>
  </div>
  <table class="table table-sm">
    <thead class="thead-inverse">
    <tr>
      <th>Position</th>
      <th>Team No</th>
      <th>Team</th>
      <th>Gauntlet Checkpoints</th>
      <th>Actual Distance</th>
      <th>Penalties</th>
      <th>Competition Distance</th>
    </tr>
    </thead>

    <% @gauntlet.each do |entry| %>
        <tr>
          <td><%= entry.position_gauntlet %></td>
          <td><%= entry.car_no %> </td>
          <td><%= link_to entry.name,team_path(entry.team) %></td>
          <td><%= entry.result_gauntlet_guards %></td>
          <td><%= number_with_precision(entry.dist_gauntlet/1000.0, precision: 2) %>km</td>
          <td><%= number_with_precision(entry.dist_penalty_gauntlet/1000.0, precision: 2) %>km</td>
          <td><%= number_with_precision(entry.dist_multiplied_gauntlet/1000.0, precision: 2) %>km</td>
        </tr>
    <% end %>
  </table>
</div>

<% @tsetselegs.each do |leg| %>
    <div class="col-sm-7">
      <div class="heading-bar">
        <h3><%= leg.guard1.sponsor.name %> to <%= leg.guard2.sponsor.name %> <%= leg.is_gauntlet ? '(Gauntlet)' : '' %><%= leg.is_tsetse ? '(Tsetse line)' : '' %></h3>
        <%=number_with_precision( leg.distance_m/1000.0, precision: 2) %>km
      </div>
      <table class="table table-sm">
        <thead class="thead-inverse">
        <tr>
          <th>Position</th>
          <th>Team No</th>
          <th>Team</th>
          <th>Distance</th>
          <th>Multiple</th>
          <th>Time</th>
        </tr>
        </thead>

        <% leg.entry_legs.order(distance_m: :asc).each_with_index do |entry_leg,i| %>
            <tr>
              <td><%= i+1 %></td>
              <td><%= entry_leg.entry.car_no %></td>
              <td><%= link_to entry_leg.entry.name,team_path(entry_leg.entry.team) %></td>
              <td><%= number_with_precision(entry_leg.distance_m/1000.0, precision: 2) %>km</td>
              <td><%= number_with_precision(entry_leg.distance_m / parse_float(leg.distance_m,false),precision:2) %>x</td>
              <td><%= entry_leg.elapsed_s/60%> min</td>
            </tr>
        <% end %>

      </table>
    </div>
<% end %>